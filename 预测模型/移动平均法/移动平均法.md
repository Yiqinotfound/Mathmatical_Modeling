

## 1. 模型概览

### 1.1 学科分属

&emsp;&emsp;在统计学中，移动平均法是用一组最近的实际数据值来预测未来一期或几期内公司产品的需求量、公司产能等的一种常用方法。移动平均法适用于即期预测。

### 1.2 历史发展

&emsp;&emsp;一般地，人们认为现代时间序列分析起源于英国统计学家 G.u.Yule 在 1927 年提出的 AR（Auto Regressive，自回归）模型。该模型与英国统计学家 G.T.Walker 在 1931 年提出了 MA（Moving Average，移动平均）模型和 ARMA 模型，构成了时间序列分析的基础，至今仍被大量应用。这三个模型主要应用于单变量、同方差场合的平稳序列。

## 2. 模型介绍

### 2.1 具体模型介绍

移动平均法是一种简单平滑预测技术，它的基本思想是：根据时间序列资料、逐项推移，依次计算包含一定项数的序时平均值，以反映长期趋势的方法。因此，当时间序列的数值由于受周期变动和随机波动的影响，起伏较大，不易显示出事件的发展趋势时，使用移动平均法可以消除这些因素的影响，显示出事件的发展方向与趋势（即趋势线），然后依趋势线分析预测序列的长期趋势。移动平均法可以分为：简单移动平均和加权移动平均。


#### 2.1.1简单移动平均法

**机理**：根据时间序列资料逐渐推移，依次计算包含一定项数的时序平均数，以反映长期趋势的方法。而简答移动平均的个元素的权重都相等。


**数学推导**：设观测序列为 $y_1,...,y_T$，取移动平均的项数$N < T$ 。一次简单移动平均值计算公
式为：

$$M_t^{(1)} = \frac{1}{N}(y_t+y_{t-1}+...+y_{t-N+1})=M_{t-1}^{(1)}+\frac{1}{N}(y_t-y_{t-N}）$$

当预测目标的基本趋势是在某一水平上下波动时，可用一次简单移动平均方法建立预测模型：

$$\hat{y}_{t+1} = M_{t+1}^{(1)} = \frac{1}{N}(\hat{y}_t+...+\hat{y}_{t-N+1}), t = N,N+1,...$$

其预测标准误差为：

$$S = \sqrt{\frac{\sum_{t=N+1}^{T}(\hat{y}_t-y_t)^2}{T-N}}$$

最近 N 期序列值的平均值作为未来各期的预测结果。一般N 取值范围：5 ≤ N ≤ 200。当历史序列的基本趋势变化不大且序列中随机变动成分较多时，N 的取值应较大一些。否则N 的取值应小一些。在有确定的季节变动周期的资料中，移动
平均的项数应取周期长度。选择最佳N 值的一个有效方法是，比较若干模型的预测误
差。预测标准误差最小者为好。

简单移动平均法只适合做近期预测，而且是预测目标的发展趋势变化不大的情况。如果目标的发展趋势存在其它的变化，采用简单移动平均法就会产生较大的预测偏差和滞后


#### 2.1.2加权移动平均法

**机理**：在简单移动平均公式中，每期数据在求平均时的作用是等同的。但是，每期数据所包含的信息量不一样，近期数据包含着更多关于未来情况的信心。因此，把各期数据等同看待是不尽合理的，应考虑各期数据的重要性，对近期数据给予较大的权重，这就是加权移动平均法的基本思想。


**数学推导**：设时间序列为$y_1,...,y_t$；加权移动平均公式为

$$M_{tw} = \frac{w_1y_t+w_2y_2+...+w_Ny_{t-N+1}}{w_1+w_2+...+w_N}, t\ge N$$

式中$M_{tw}$为$t$期加权移动平均数；$W_i$为$y_{t-i+1}$的权数，它体现了相应的$y_t$在加权平均数中的重要性。

利用加权移动平均数来做预测，其预测公式为


$$\hat{y}_{t+1} = M_{tw}$$

即以第$t$期加权移动平均数作为第$t+1$期的预测。

在加权移动平均法中，$w_t$的选择，同样具有一定的经验性。一般的原则是：近期数据的权数大，远期数据的权数小。至于大到什么程度和小到什么程度，则需要按照预测者对序列的了解和分析来确定。


### 2.2 模型变种

#### 趋势移动平均法

**机理**：简单移动平均法和加权移动平均法，在时间序列没有明显的趋势变动时，能够准确反映实际情况。但当时间序列出现直线增加或减少的变动趋势时，用简单移动平均法和加权移动平均法来预测就会出现滞后偏差。因此，需要进行修正，修正的方法是作二次移动平均，利用移动平均滞后偏差的规律来建立直线趋势的预测模型。这就是趋势移动平均法。


**数学推导**：一次移动的平均数为:


$$M_{t+1}^{(1)} = \frac{1}{N}(\hat{y}_t+...+\hat{y}_{t-N+1})$$

在一次移动平均的基础上再进行一次移动平均就是二次移动平均，其计算公式为:


$$M_{t+1}^{(1)} = \frac{1}{N}(M_T^{(1)}+...+M_{t-N+1}^{(1)}) = M_{t-1}^{(2)}+\frac{1}{N}(M_T^{(1)}+...+M_{t-N}^{(1)})$$

下面讨论如何利用移动平均的滞后偏差建立直线趋势预测模型。

设时间序列$y_t$从某时期开始具有直线趋势，且认为未来时期也按此直线趋势变化，则可设此直线趋势预测模型为


$$\hat{y}_{t+T} = a_t+b_tT, T = 1,2...$$

式中$t$为当前时期数；$T$为由$t$至预测时期的时期数；$a_t$为截距；$b_t$为斜率。两者又称为平滑系数。

现在，我们根据移动平均值来确定平滑系数


$$a_t=y_t\\
y_{t-1} = y_t-b_t\\
y_{t-2} = y_t-2b_t\\
...\\
y_{t-N+1} = y_t-(N-1)b_t$$

所以：
$$M_T^{(1)} = \frac{y_t+y_{t-1}+...+y_{t-N+1}}{N} = y_t-\frac{N-1}{2}b_t$$
因此：
$$y_t-M_t^{(1)}=\frac{N-1}{2}b_t$$
同理：
$$y_{t-1}-M_{y-1}^{(1)} = \frac{N-1}{2}b_t$$
所以：
$$y_t-y_{t-1}= M_t^{(1)}-M_{t-1}^{(1)}=b_t\\
M_t^{(1)}-M_{t}^{(2)}=\frac{N-1}{2}b_t$$
于是可得平滑系数的计算公式为：
$$a_t = 2M_t^{(1)}-M_t^{(2)}\\
b_t = \frac{2}{N-1}(M_t^{(1)}-M_t^{(2)})$$
趋势移动平均法对于同时存在直线趋势与周期波动的序列，是一种既能反映趋势变化，又可以有效地分离出来周期变动的方法。


## 3. 模型应用

### 3.1 常见应用场景

移动平均法是用一组最近的实际数据值来预测未来一期或几期内公司产品的需求量、公司产能等的一种常用方法。移动平均法适用于即期预测。当产品需求既不快速增长也不快速下降，且不存在季节性因素时，移动平均法能有效地消除预测中的随机波动，是非常有用的。移动平均法根据预测时使用的各元素的权重不同。


**公交运行时间预测中的应用**：公交车运行时间原始数据的采集采用的是人工测试法，即由记录人员从起始点到终点跟踪每辆客车，并记录下车辆在每个站点之间的运行时间。通过采集公交车三个工作日的运行时间，并运用移动平均法即可预测工作日的运行时间。

**房地产中价格预测的运用**：某类房地产某年由于各月的价格受某些不确定因素的影响，时高时低，变动较大。如果不予分析，不易显现其发展趋势。如果把每几个月的价格加起来计算其移动平均数，建立一个移动平均数时间序列，就可以从平滑的发展趋势中明显地看出其发展变动的方向和程度，进而可以预测未来的价格。
在计算移动平均数时，每次应采用几个月来计算，需要根据时间序列的序数和变动周期来决定。如果序数多，变动周期长，则可以采用每6个月甚至每12个月来计算;反之，可以采用每2个月或每5个月来计算。


**计算销售额中的运用**：得知某商场1月份至11月份的实际销售额，假定跨期为3个月，可通过加权移动平均法预测12月份的销售额。

### 3.2 数学建模竞赛应用

#### 3.2.1 简单移动平均法

题目：某企业 1 月～ 11月份的销售收入时间序列如表1示。试用一次简单滑动平均法预测第 12 月份的销售收入。

![企业销售收入][1]

![解析1.1][2]
![解析1.2][3]

可视化：
![可视化1][4]

#### 3.2.2 加权移动平均法

题目：我国1979～1988 年原煤产量如表2 所示，试用加权移动平均法预测1989 年的产量。
![煤产量][5]
![煤产量误差][6]

![解析2][7]

可视化：
![可视化2][8]

#### 3.2.3 趋势移动平均法

题目：我国 1965～1985 年的发电总量如表 3 所示，试预测 1986 年和 1987 年的发 电总量。
![发电量][9]

解 由散点图 1 可以看出，发电总量基本呈直线上升趋势，可用趋势移动平均法 来预测。
![解析][10]

可视化：
![可视化3][11]

## 4.软件/程序介绍

### 4.1 模拟介绍

> 简单移动平均法 MATLAB程序

```matlab
clear
clc
y=[533.8 574.6 606.9 649.8 705.1 722.0 816.4 892.7 963.9 1015.1 1102.7];
m=length(y);
n=[4,5]; % 移动平均取的项数
for i=1:length(n)
 for j=1:m-n(i)+1
  yhat{i}(j)=sum(y(j:j+n(i)-1))/n(i);%计算M_t(1)
 end
 y12(i)=yhat{i}(end);
 s(i)=sqrt(mean((y(n(i)+1:m)-yhat{i}(1:end-1)).^2));%计算S
end
y12,s
```

> 加权移动平均法 MATLAB程序

```matlab
clear
clc
y=[6.35 6.20 6.22 6.66 7.15 7.89 8.72 8.94 9.28 9.8];
w=[1;2;3];%权值
factor=w./sum(w);
m=length(y);
n=3;
for i=1:m-n+1
 yhat(i)=y(i:i+n-1)*factor;
end
yhat
err=abs(y(n+1:m)-yhat(1:end-1)./y(n+1:m))
T_err=1-sum(yhat(1:end-1))/sum(y(n+1:m))%计算总的平均相对误差
y1989=yhat(end)/(1-T_err)
```

> 趋势移动平均法 MATLAB程序

```matlab
clear
clc
load y.txt% 原始数据保存于纯文本文件
m1=length(y);
n=6;%移动平均的项数
for i=1:m1-n+1
 yhat1(i)=sum(y(i:i+n-1))/n;%计算M1
end
yhat1
m2=length(yhat1);
for i=1:m2-n+1
 yhat2(i)=sum(yhat1(i:i-n+1))/n;%计算M2
end
yhat2
plot(1:21,y,'*')
a21=2*yhat1(end)-yhat2(end)
b21=2*(yhat1(end)-yhat2(end))/(n-1)
y1986=a21+b21
y1987=a21+2*b21
```

 [1]: https://img-blog.csdnimg.cn/20190421220116859.png
 [2]: https://img-blog.csdnimg.cn/2019042122014189.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5ODMxMTYz,size_16,color_FFFFFF,t_70
 [3]: https://img-blog.csdnimg.cn/20190421220200123.png
 [4]: ./可视化1.png
 [5]: https://img-blog.csdnimg.cn/20190421220319714.png
 [6]: https://img-blog.csdnimg.cn/20190421220341150.png
 [7]: https://img-blog.csdnimg.cn/20190421220358395.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5ODMxMTYz,size_16,color_FFFFFF,t_70
 [8]: ./可视化2.png
 [9]: https://img-blog.csdnimg.cn/20190421220619337.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5ODMxMTYz,size_16,color_FFFFFF,t_70
 [10]: https://img-blog.csdnimg.cn/20190421220658193.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5ODMxMTYz,size_16,color_FFFFFF,t_70
 [11]: ./可视化3.png


## 5. 参考文献

百度百科--移动平均法
<https://baike.baidu.com/item/%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87%E6%B3%95/10785547?fr=aladdin>

百度百科--时间序列模型
<https://baike.baidu.com/item/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B/6990876?fr=aladdin>

MBA智库百科--移动平均法
<https://wiki.mbalib.com/wiki/%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87%E6%B3%95>

CSDN博客--时间序列模型（二）：移动平均法
<https://blog.csdn.net/qq_29831163/article/details/89440426>

CSDN博客--时间序列模型（1）--移动平均法
<https://blog.csdn.net/llglaodie/article/details/114281680>
